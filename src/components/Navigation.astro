---
// Navigation component that dynamically loads from content files

// Get all markdown files from content directory organized by sections
const cssFiles = await Astro.glob('../content/css/*.mdx');
const jsFiles = await Astro.glob('../content/javascript/*.mdx');

// Helper function to create navigation items
const createNavItems = (files: any[], section: string) => {
  return files
    .filter((file: any) => !file.url?.includes('index'))
    .map((file: any) => {
      const slug = file.frontmatter?.slug || file.url?.split('/').pop()?.replace('.mdx', '') || 'untitled';
      return {
        title: file.frontmatter?.title || slug,
        slug: slug,
        description: file.frontmatter?.description || '',
        section: section,
        isActive: Astro.url.pathname === `/${slug}`
      };
    })
    .sort((a: any, b: any) => a.title.localeCompare(b.title));
};

// Create sections
const sections = [
  {
    name: 'CSS',
    icon: 'üé®',
    items: createNavItems(cssFiles, 'css')
  },
  {
    name: 'JavaScript',
    icon: '‚ö°',
    items: createNavItems(jsFiles, 'javascript')
  }
];

// Flatten all items for JavaScript access
const allItems = sections.flatMap(section => section.items);
const navigationData = JSON.stringify(allItems);
---

<div class="space-y-1">
  <a href="/" class={`sidebar-link flex items-center ${Astro.url.pathname === '/' ? 'active' : ''}`}>
    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
    </svg>
    Inicio
  </a>
</div>

<div class="mt-6">
  <h3 class="px-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
    Gu√≠as
  </h3>
  
  {sections.map((section) => (
    <div class="mt-4">
      <h4 class="px-4 text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
        <span>{section.icon}</span>
        <span>{section.name}</span>
      </h4>
      <div class="mt-2 space-y-1">
        {section.items.map((item) => (
          <a 
            href={`/${item.slug}`} 
            class={`sidebar-link block ${item.isActive ? 'active' : ''}`}
            data-slug={item.slug}
          >
            {item.title}
          </a>
        ))}
      </div>
    </div>
  ))}
</div>

<!-- Store navigation data in a global script for client-side access -->
<script is:inline>
  // Store navigation data globally
  window.navigationData = {navigationData};
  
  // Function to update active navigation
  function updateActiveNavigation() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.sidebar-link');
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href === currentPath) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }
  
  // Update active navigation when page loads
  document.addEventListener('DOMContentLoaded', updateActiveNavigation);
  
  // Update active navigation when navigating (for SPA-like behavior)
  document.addEventListener('click', (e) => {
    const link = e.target.closest('a[href^="/"]');
    if (link && !link.href.includes('#')) {
      setTimeout(updateActiveNavigation, 100);
    }
  });
</script>